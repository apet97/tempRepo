<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description"
    content="OTPLUS - Advanced overtime analysis addon for Clockify with profile-based capacity tracking, holiday integration, and billable hour breakdowns.">
  <title>OTPLUS â€” Overtime Summary</title>
  <link rel="manifest" href="manifest.json">
  <link rel="preconnect" href="https://resources.developer.clockify.me">
  <link rel="stylesheet" href="https://resources.developer.clockify.me/ui/latest/css/main.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/styles.css">
</head>

<body class="density-compact">
  <div class="container">

    <!-- Header / Filter Bar -->
    <div class="card filter-bar-compact">
      <div class="filter-row">
        <h1 class="compact-title">OTPLUS</h1>
        <div class="button-group">
          <button class="btn-primary btn-sm" id="generateBtn" aria-busy="false">Generate</button>
          <button class="btn-secondary btn-sm" id="exportBtn" disabled>Export CSV</button>
        </div>
      </div>
      <div class="filter-row">
        <div class="date-input-group">
          <label for="startDate" class="date-label">From</label>
          <input type="date" id="startDate" class="compact-date" aria-label="Start date">
        </div>
        <div class="date-input-group">
          <label for="endDate" class="date-label">To</label>
          <input type="date" id="endDate" class="compact-date" aria-label="End date">
        </div>
        <div class="button-group" style="margin-left: 12px; align-self: flex-end;">
          <button class="btn-text btn-xs" id="datePresetLastMonth">Last Month</button>
          <button class="btn-text btn-xs" id="datePresetThisMonth">This Month</button>
        </div>
      </div>
    </div>

    <!-- Configuration Card -->
    <div class="card">
      <div class="card-title">
        <button type="button" class="section-toggle-btn" id="configToggle" aria-expanded="true"
          aria-controls="configContent">
          <span class="toggle-icon" aria-hidden="true">&#9660;</span>
          Configuration
        </button>
      </div>
      <div id="configContent" role="region" aria-labelledby="configToggle">
        <div class="config-toggle-grid">
          <label class="config-item">
            <input type="checkbox" id="useProfileCapacity" checked> Profile Capacity
          </label>
          <label class="config-item">
            <input type="checkbox" id="useProfileWorkingDays" checked> Working Days
          </label>
          <label class="config-item">
            <input type="checkbox" id="applyHolidays" checked> Apply Holidays
          </label>
          <label class="config-item">
            <input type="checkbox" id="applyTimeOff" checked> Apply Time Off
          </label>
          <label class="config-item">
            <input type="checkbox" id="showBillableBreakdown" checked> Billable Breakdown
          </label>
        </div>
        <div class="config-inline">
          <label class="config-item">
            Daily Threshold <input type="number" id="configDaily" value="8" min="1" max="24" class="config-input-sm"
              aria-label="Daily Capacity Threshold in Hours">
            hrs
          </label>
          <label class="config-item">
            Multiplier <input type="number" id="configMultiplier" value="1.5" min="1" max="5" step="0.1"
              class="config-input-sm" aria-label="Overtime Multiplier"> x
          </label>
        </div>
      </div>
    </div>

    <!-- API Status Banner -->
    <div id="apiStatusBanner" class="card hidden api-status-banner" role="alert" aria-live="polite" aria-atomic="true">
    </div>

    <!-- Loading -->
    <div id="loadingState" class="hidden" role="status" aria-live="polite" aria-label="Loading report data">
      <div class="skeleton" aria-hidden="true"></div>
      <div class="skeleton" aria-hidden="true"></div>
    </div>

    <!-- Results Container -->
    <div id="resultsContainer" class="hidden" aria-live="polite">

      <!-- Summary Strip -->
      <div class="summary-inline" id="summaryStrip"></div>

      <!-- Tab Navigation -->
      <div class="card tab-nav-card" id="tabNavCard" role="tablist" aria-label="Report views">
        <button type="button" class="btn-text btn-xs tab-btn active" data-tab="summary" role="tab" aria-selected="true"
          aria-controls="summaryCard" id="tab-summary">Summary</button>
        <button type="button" class="btn-text btn-xs tab-btn" data-tab="detailed" role="tab" aria-selected="false"
          aria-controls="detailedCard" id="tab-detailed">Detailed</button>
      </div>

      <!-- Summary Card -->
      <div class="card" id="summaryCard" role="tabpanel" aria-labelledby="tab-summary">
        <div class="table-scroll">
          <table class="report-table" aria-label="User summary">
            <thead>
              <tr>
                <th scope="col">User</th>
                <th scope="col" class="text-right">Capacity</th>
                <th scope="col" class="text-right">Regular</th>
                <th scope="col" class="text-right">Overtime</th>
                <th scope="col" class="text-right">Total</th>
                <th scope="col" class="text-right">Utilization</th>
                <th scope="col" class="text-right">Amount</th>
              </tr>
            </thead>
            <tbody id="summaryTableBody"></tbody>
          </table>
        </div>
      </div>

      <div class="card hidden" id="detailedCard" role="tabpanel" aria-labelledby="tab-detailed">
        <div class="filter-chips" id="detailedFilters" role="group" aria-label="Filter entries">
          <button type="button" class="chip active" data-filter="all">All Entries</button>
          <button type="button" class="chip" data-filter="holiday">Holidays Only</button>
          <button type="button" class="chip" data-filter="offday">Off-days Only</button>
          <button type="button" class="chip" data-filter="billable">Billable Only</button>
        </div>
        <div id="detailedTableContainer"></div>
      </div>
    </div>

    <!-- User Overrides -->
    <div class="card">
      <div class="card-title">User Overrides</div>
      <div class="table-scroll overrides-table-container">
        <!-- MEDIUM FIX #21: Added scope="col" for accessibility -->
        <table class="overrides-table" aria-label="User capacity overrides">
          <caption class="visually-hidden">Configure individual user capacity and overtime multiplier</caption>
          <thead>
            <tr>
              <th scope="col">User</th>
              <th scope="col">Capacity (Hrs)</th>
              <th scope="col">Multiplier (x)</th>
            </tr>
          </thead>
          <tbody id="userOverridesBody"></tbody>
        </table>
      </div>
    </div>

    <div id="emptyState" class="card empty-state">
      Select dates to begin.
    </div>

  </div>

  <!-- Entry Point -->
  <script type="module" src="js/main.js?v=15"></script>
</body>

</html>