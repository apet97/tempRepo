{\rtf1\ansi\ansicpg1252\cocoartf2822
\cocoatextscaling0\cocoaplatform0{\fonttbl\f0\fswiss\fcharset0 Helvetica;}
{\colortbl;\red255\green255\blue255;}
{\*\expandedcolortbl;;}
\paperw11900\paperh16840\margl1440\margr1440\vieww11520\viewh8400\viewkind0
\pard\tx720\tx1440\tx2160\tx2880\tx3600\tx4320\tx5040\tx5760\tx6480\tx7200\tx7920\tx8640\pardirnatural\partightenfactor0

\f0\fs24 \cf0 # OTPLUS Project Context\
\
## Project Overview\
OTPLUS is a vanilla JavaScript addon for Clockify that calculates overtime, capacity, and billable breakdowns. It fills the gap in Clockify's native reporting by providing summary views and profile-based capacity tracking.\
\
## Tech Stack\
* **Core:** Vanilla JavaScript (ES Modules). No build step (no Webpack/Vite).\
* **Architecture:** Controller-based (`main.js` orchestrates, `ui.js` renders, `api.js` fetches).\
* **State:** Reactive centralized store (`state.js`) with Pub/Sub pattern.\
* **Testing:** Jest environment (`npm test`).\
\
## Critical Constraints (Do Not Break)\
1.  **Rate Limiting (`js/api.js`):**\
    * **Strict Token Bucket:** We use a custom token bucket to limit requests to 50/sec.\
    * **Retry Logic:** The retry loop for 429 errors must **NOT** increment the `attempt` counter manually inside the catch block; the loop header handles this.\
    * **Spin Lock Prevention:** The refill check must be `>= REFILL_INTERVAL` (not `>`) to prevent 0ms CPU spinning.\
\
2.  **Data Integrity (`js/export.js`):**\
    * **Gapless Exports:** The CSV generator **MUST** produce a row for every date in the range, even if the user has 0 time entries (e.g., for Holidays/Time Off). Do not rely solely on `day.entries.forEach` without a fallback for empty arrays.\
    * **Injection Protection:** All CSV fields starting with `=`, `+`, `-`, or `@` must be escaped with a leading single quote `'`.\
\
3.  **Concurrency (`js/main.js`):**\
    * **Abort Handling:** When handling `Promise.allSettled` for optional fetches (Profiles, Holidays), always ignore `AbortError`. These are user-initiated cancellations, not API failures.\
\
## Common Tasks\
* **Run Tests:** `npm test`\
* **Linting:** Follow standard JS formatting; no automated linter.}